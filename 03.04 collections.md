#集合

PHP提供了一个主要的机制来表达元素的集合：PHP数组。传统意义上，编程语言中的“数组”被认为是元素的集合，使用连续整数作为索引（可以是从0或者1开始），大小可能是固定的（比如Java中的数组）。PHP数组与传统意义上的数组大不相同。

PHP数组基本上是一种字典类型的集合，将值与键相关联，并维持插入时的顺序。键可以是整数也可以是字符串，而值可以是任意类型。PHP数组的大小是动态的，随着需要变大。在所有Hack文档中，“数组”总被认为指的是PHP数组，除非另有明确说明。PHP中的数组构造用的是`array()`语句或者`[]`。比如：

```
<?php

// Simple array with the values 1, 2, 3 and default
// indexed by integers, starting with 0
$arr1 = array(1, 2, 3);

// Another simple array with the values "a", "b", "c"
// and again default indexed by integers
$arr2 = array("a", "b", "c");

// Array with strings as both keys and values
$arr3 = array("a" => "aaa", "b" => "bbb", "c" => "ccc");

// Array containing the values 1, 2, 3 but now indexed
// by a mix of integer keys and string keys
$arr4 = array("foo" => 1, 73 => 2, "bar" => 3);

// Array having mixed-typed values, default indexed by
// integers.
$arr5 = array(1, "hello", array(2, 3), "goodbye");

// Dynamically grow arrays by just adding new values. The
// keys do not have to be sequential or of the same type.
$arr1[] = 4; // The key will be 3
$arr1[4] = 5;
$arr2["bap"] = 6;
$arr3["d"] = "ddd";
$arr4[] = "blah"; // The key will be 74
$arr5[9] = 3;
```
代码演示见[http://www.rsywx.com:8080/demo/04.01.php_array](http://www.rsywx.com:8080/demo/04.01.php_array.async)。

上面的例子很简单，但我们也很容易能看出PHP数组和其它编程语言中的“数组”大不一样。除了提供类似词典样子的操作外，PHP数组还提供类似栈样子的操作（PHP数组的值可以推入、弹出、移位）。

Hack加入了集合类型和接口。Hack对泛型也是支持的，于是Hack加入了原生类、内置参数化集合（如向量和映射）。集合专用于数据存取。集合实现了很多相同的接口，可以扩展以创建更特殊的集合。

虽说数组的应用方向是“一个数组多种应用”的模式，Hack集合试图提供更专门的应用。和数组一样，集合中元素值的类型一般而言可以是任意类型。

**注意：**在PHP5和Hack中，数组不是对象。但Hack集合是对象。

```
<?hh
$a = array(1, 2);
$v = Vector {1, 2};
var_dump(is_object($a));
var_dump(is_object($v));
```
的输出是：
```
bool(false)
bool(true)
```
代码演示见[http://www.rsywx.com:8080/demo/04.02.collection_object](http://www.rsywx.com:8080/demo/04.02.collection_object.async)。

目前Hack实现了如下的集合类型：

* `Vector`：有序，有索引的列表集合。
* `ImmVector`：有序，有索引，不可修改的列表集合。
* `Map`：有序，词典集合。
* `ImmMap`：有序，不可修改的词典集合。
* `Set`：列表集合，存放唯一值。
* `ImmSet`：不可修改的列表集合，存放唯一值。
* `Pair`：有索引的集合，不多不少存放两个元素。

**注意：**以上所有这些类都是`final`的。

除了`Pair`之外，上面这些集合实现的主要接口有两种：一种是常规的读写接口，一种是只读接口。读写接口的前缀是`Mutable`，只读接口的前缀是`Const`。

下面是一个例子：

```
<?hh

function main_col() {

  $vector = Vector {5, 10};

  $vector->add(15);
  $vector->add(20);

  $vector[] = 25;

  $vector->removeKey(2);

  foreach ($vector as $item) {
    echo $item . "\n";
  }
}

main_col();
```
代码输出为：
```
5
10
20
25
```
代码演示见[http://www.rsywx.com:8080/demo/04.03.vector](http://www.rsywx.com:8080/demo/04.03.vector)。